<!DOCTYPE html>
<html>
<head>
  <title>schema.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../", thisFile = "core/server/data/schema.js", defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>
  <script src="../../../fileSearch.js"></script>
  <link rel="stylesheet" href="../../../fileSearch.css" />
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#schema">Schema</a>
      </div>
      <div class="heading h2">
        <a href="#db%20design">DB Design</a>
      </div>
      <div class="heading h3">
        <a href="#users%20%E7%94%A8%E6%88%B7%E5%AE%9E%E4%BD%93">users 用户实体</a>
      </div>
      <div class="heading h3">
        <a href="#app">APP</a>
      </div>
      <div class="heading h3">
        <a href="#%E9%80%9A%E7%9F%A5">通知</a>
      </div>
      <div class="heading h3">
        <a href="#%E8%A7%92%E8%89%B2">角色</a>
      </div>
      <div class="heading h3">
        <a href="#%E6%9D%83%E9%99%90">权限</a>
      </div>
      <div class="heading h3">
        <a href="#groups%20%E7%BE%A4%E7%BB%84%E5%AE%9E%E4%BD%93">groups 群组实体</a>
      </div>
      <div class="heading h3">
        <a href="#circles%20%E5%9C%88%E5%AD%90%E5%AE%9E%E4%BD%93">circles 圈子实体</a>
      </div>
      <div class="heading h3">
        <a href="#%E6%B6%88%E6%81%AF%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E6%B6%88%E6%81%AF%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%B6%88%E6%81%AF%E5%92%8C%E8%81%8A%E5%A4%A9%E6%B6%88%E6%81%AF">消息实体 一定要考虑消息的共通性，系统消息和聊天消息</a>
      </div>
      <div class="heading h3">
        <a href="#%E5%B8%96%E5%AD%90%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E5%B8%96%E5%AD%90%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E5%8F%91%E5%B8%96%EF%BC%88%E6%97%A5%E5%BF%97%EF%BC%89%EF%BC%9B%E5%AD%98%E5%9C%A8%E4%BA%8E%E5%9C%88%E5%AD%90%E9%87%8C%EF%BC%88%E6%89%80%E4%BB%A5%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9C%88%E5%AD%90%EF%BC%8C%E5%A5%BD%E5%8F%8B%E5%9C%88%EF%BC%8C%E5%85%B6%E4%BB%96%E5%9C%88%E5%AD%90%E9%83%BD%E6%98%AF%E9%A2%9D%E5%A4%96%E5%88%9B%E5%BB%BA%E7%9A%84%EF%BC%89">帖子实体 一定要考虑帖子的共通性，发帖（日志）；存在于圈子里（所以人，都有一个自己的圈子，好友圈，其他圈子都是额外创建的）</a>
      </div>
      <div class="heading h3">
        <a href="#%E5%9B%9E%E5%B8%96%E5%AE%9E%E4%BD%93">回帖实体</a>
      </div>
      <div class="heading h3">
        <a href="#%E8%AE%BE%E7%BD%AE%E5%AE%9E%E4%BD%93%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%EF%BC%8C%E4%B9%9F%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B8%80%E4%BA%9B%E7%B3%BB%E7%BB%9F%E7%BA%A7%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">设置实体，相当于数据字典，也相当于一些系统级的默认配置</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>schema.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mongoose&quot;</span><span class="p">).</span><span class="nx">Schema</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="schema">
  <h1>
    <a href="#schema" name="schema" class="pilcrow">&#182;</a>
    Schema
  </h1>
</div>


<p>这里定义了数据库实体的字段信息，export后供models模块使用
Schema Type 都有哪些：
1. String: { type: String, enum: ['one','two','three'], lowercase: true, match: [ /.html$/, "That file doesn't end in .html ({VALUE})" ], trim: true, uppercase: true }
2. Number: { type: Number, max: 10, min: 2 }
3. Date: { type: Date, expires: 60<em>60</em>24 }</p>

<blockquote>
  <p>Default SchemaTypes available for all types
  1. index: true or false, 'hashed' '2d' '2dsphere', { type: '2dsphere', sparse: true } { unique: true, expires: '1d' }
  2. required: true or false
  3. select: true or false - Set to true if this path should always be included in the results
  4. set: function - should receive a value and return a tweaked value to be set on this field
  5. sparse: true or false - sparse index
  6. unique: true or false - unique index
  7. validate: function receive a value return true or false, [function, msg], [{validator:validator, msg:msg},{...}]
  8. default: value
  9. get: function - should receive a value and return a tweaked value to get</p>
</blockquote>


<div class="pilwrap" id="db%20design">
  <h2>
    <a href="#db%20design" name="db%20design" class="pilcrow">&#182;</a>
    DB Design
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="users%20%E7%94%A8%E6%88%B7%E5%AE%9E%E4%BD%93">
  <h3>
    <a href="#users%20%E7%94%A8%E6%88%B7%E5%AE%9E%E4%BD%93" name="users%20%E7%94%A8%E6%88%B7%E5%AE%9E%E4%BD%93" class="pilcrow">&#182;</a>
    users 用户实体
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">users</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">nickname</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// nickname</span>
        <span class="nx">lowercase_username</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">username</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// used for sign in</span>
        <span class="nx">password</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">email</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">match</span><span class="o">:</span> <span class="sr">/.*?@.*?/</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">phone</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">match</span><span class="o">:</span> <span class="sr">/1[0-9]{10}/</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">avatar</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// be what, for file storage, not sure</span>
        <span class="nx">images</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">}],</span> <span class="c1">// be what, for file storage, not sure</span>
        <span class="nx">credit</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span> <span class="c1">// 积分，也就是经验值</span>
        <span class="nx">bio</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;I love iCollege&#39;</span><span class="p">},</span>
        <span class="nx">signature</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;I love iCollege&#39;</span><span class="p">},</span>
        <span class="nx">gender</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;unknown&#39;</span><span class="p">},</span>
        <span class="nx">birth_date</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">website</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;http://blog.icollege.com&#39;</span><span class="p">},</span>
        <span class="nx">location</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="s1">&#39;2dsphere&#39;</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mf">0.0</span><span class="p">}],</span>
        <span class="nx">location_info</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">profile_visibility</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;private, public, friends_only&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;friends_only&#39;</span><span class="p">},</span>
        <span class="nx">tags</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">}],</span> <span class="c1">// 用户个性标签</span>
        <span class="nx">status</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="s1">&#39;invisible&#39;</span><span class="p">,</span> <span class="s1">&#39;offline&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;offline&#39;</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// online offline or ...</span>
        <span class="nx">language</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">,</span> <span class="s1">&#39;en_US&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;zh_CN&#39;</span><span class="p">},</span>
        <span class="nx">last_login</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">},</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">groups</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">group_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;Group&#39;</span><span class="p">},</span>
            <span class="nx">message_alert</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">location_share</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">profile_visible</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>
            <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span> <span class="c1">// 记录了什么时候加入群组的信息</span>
            <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
        <span class="p">}],</span>
        <span class="nx">circles</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">circle_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;Circle&#39;</span><span class="p">},</span>
            <span class="nx">post_alert</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">location_share</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">profile_visible</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>
            <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span> <span class="c1">// 记录了什么时候加入圈子的信息</span>
            <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
        <span class="p">}],</span>
        <span class="nx">friends</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">friend_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;User&#39;</span><span class="p">},</span>
            <span class="nx">remark_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 好友备注名称</span>
            <span class="nx">friend_group</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 好友所属分组， 这个灵活些~</span>
            <span class="nx">esp_care</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 特别关心此好友吗</span>
            <span class="nx">message_block</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 屏蔽消息</span>
            <span class="nx">status</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;refused&#39;</span><span class="p">,</span> <span class="s1">&#39;agreed&#39;</span><span class="p">,</span> <span class="s1">&#39;expired&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;pending&#39;</span><span class="p">},</span> <span class="c1">// 已经成为好友了吗，好友记录会在好友申请提交后插入，但是状态为pending，但是一旦被refuse，该记录择日会被清除，但是由好友申请构建的好友系统消息不会消失</span>
            <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>  <span class="c1">// 记录了什么时候添加好友的信息</span>
            <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
        <span class="p">}],</span>
        <span class="nx">roles</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span>
            <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;Role&#39;</span>
        <span class="p">}],</span>
        <span class="nx">permissions</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">permission_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;Permission&#39;</span><span class="p">},</span>
            <span class="nx">permission_scope</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;related&#39;</span><span class="p">,</span> <span class="s1">&#39;me&#39;</span><span class="p">]},</span> <span class="c1">// 最高Scope，无限制，有关联，仅限自己</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>if the scope is 'related' or 'me', object fields and values are not allowed to be optionally provided</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">object_fields</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">}],</span>
            <span class="nx">object_values</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">}]</span>
        <span class="p">}],</span>
        <span class="nx">apps</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">app_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;App&#39;</span><span class="p">},</span>
            <span class="nx">app_fields</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
                <span class="nx">key</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
                <span class="nx">value</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
                <span class="nx">type</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;markdown&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">},</span>
                <span class="nx">relatable_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
                <span class="nx">relatable_type</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;circles&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;posts&#39;</span><span class="p">},</span>
                <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
                <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
                <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
                <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
            <span class="p">}],</span>
            <span class="nx">app_settings</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
                <span class="nx">key</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
                <span class="nx">value</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
                <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
                <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
                <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
                <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
            <span class="p">}]</span>
        <span class="p">}]</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="app">
  <h3>
    <a href="#app" name="app" class="pilcrow">&#182;</a>
    APP
  </h3>
</div>


<p>所有开发者注册发布或iCollege维护的apps</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">apps</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">lowercase_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">avatar</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// be what, for file storage, not sure</span>
        <span class="nx">slug</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">version</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>这个 app 需要哪些permission，安装时需争取到用户同意，方可继续安装
app 能够拥有的permission永远是user permission的子集，这点需要验证！！！</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">permissions</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">permission_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;Permission&#39;</span><span class="p">},</span>
            <span class="nx">permission_scope</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;me&#39;</span><span class="p">]},</span> <span class="c1">// 最高Scope，无限制，有关联，仅限自己</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>if the scope is 'related' or 'me', object fields and values are not allowed to be optionally provided</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">object_fields</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">}],</span>
            <span class="nx">object_values</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">}]</span>
        <span class="p">}]</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E9%80%9A%E7%9F%A5">
  <h3>
    <a href="#%E9%80%9A%E7%9F%A5" name="%E9%80%9A%E7%9F%A5" class="pilcrow">&#182;</a>
    通知
  </h3>
</div>


<p>主要是为了应对圈子的回帖以及转发，@等动态的通知</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">notifications</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;User&#39;</span><span class="p">},</span>
        <span class="nx">note_category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;repost&#39;</span><span class="p">,</span> <span class="s1">&#39;favored&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;at&#39;</span><span class="p">],</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>  <span class="c1">// 这么几种类别: 回复，赞，转发，@ 这四种</span>
        <span class="nx">object_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 对应着以上通知的类别，跟通知有关的对象ID可能是，repost, post两种</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E8%A7%92%E8%89%B2">
  <h3>
    <a href="#%E8%A7%92%E8%89%B2" name="%E8%A7%92%E8%89%B2" class="pilcrow">&#182;</a>
    角色
  </h3>
</div>


<p>定义了用户的多个不同的角色分类</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">roles</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;SuperAdministrator&#39;</span><span class="p">,</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">,</span> <span class="s1">&#39;iColleger&#39;</span><span class="p">],</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">permissions</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">permission_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ref</span><span class="o">:</span> <span class="s1">&#39;Permission&#39;</span><span class="p">},</span>
            <span class="nx">permission_scope</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;me&#39;</span><span class="p">]},</span> <span class="c1">// 最高Scope，无限制，有关联，仅限自己</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>if the scope is 'related' or 'me', object fields and values are not allowed to be optionally provided</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">object_fields</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">}],</span>
            <span class="nx">object_values</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">}]</span>
        <span class="p">}],</span>
        <span class="nx">description</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E6%9D%83%E9%99%90">
  <h3>
    <a href="#%E6%9D%83%E9%99%90" name="%E6%9D%83%E9%99%90" class="pilcrow">&#182;</a>
    权限
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">permissions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>object_types map the sub-modules of api module</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">object_type</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
            <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;notification&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;permission&#39;</span><span class="p">,</span>
                <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;repost&#39;</span><span class="p">,</span> <span class="s1">&#39;setting&#39;</span><span class="p">],</span>
            <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>action_types map the operations of each sub-module</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">action_type</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
            <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;edit&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;generate&#39;</span><span class="p">,</span> <span class="s1">&#39;exportContent&#39;</span><span class="p">,</span>
                <span class="s1">&#39;importContent&#39;</span><span class="p">,</span> <span class="s1">&#39;deleteAllContent&#39;</span><span class="p">,</span> <span class="s1">&#39;browse&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">],</span>
            <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="groups%20%E7%BE%A4%E7%BB%84%E5%AE%9E%E4%BD%93">
  <h3>
    <a href="#groups%20%E7%BE%A4%E7%BB%84%E5%AE%9E%E4%BD%93" name="groups%20%E7%BE%A4%E7%BB%84%E5%AE%9E%E4%BD%93" class="pilcrow">&#182;</a>
    groups 群组实体
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">groups</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">nickname</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// group用于显示的名字，可以与其他群组重复的</span>
        <span class="nx">lowercase_group_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 小写形式，方便进行防止群组命名重复测试</span>
        <span class="nx">group_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 标记了群组的唯一性</span>
        <span class="nx">avatar</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// be what, for file storage, not sure</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>群主</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// user object id, who owns the group</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>

<div class="highlight"><pre><code>   <span class="err">群组管理员，非！系统管理员</span>
   <span class="nx">related_ids</span><span class="o">:</span> <span class="p">[{</span>
       <span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span>
       <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
   <span class="p">}],</span>
</code></pre></div>



<p>user list, 全部的用户列表，包含群主和管理员</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">members</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">member_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">member_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">related</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 是否为群管理员，群主也标记related为true</span>
            <span class="nx">status</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;refused&#39;</span><span class="p">,</span> <span class="s1">&#39;agreed&#39;</span><span class="p">,</span> <span class="s1">&#39;expired&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;pending&#39;</span><span class="p">}</span> <span class="c1">// 已经成为成员了吗，成员记录会在用户加入群组申请提交后插入，但是状态为pending，但是一旦被refuse，该记录择日会被清除，但是由成员申请构建生成的系统消息不会消失</span>
        <span class="p">}],</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>we have a limited range of categories for user to select, but not listed here as enums
兴趣爱好：影视，音乐，星座，动漫，运动，读书，摄影，其他
生活休闲：同城，同乡，购物，旅游，美食，美容，宠物，健康，母婴，其他
游戏
行业交流：投资，IT/互联网，建筑工程，服务，传媒，营销与广告，教师，律师，公务员，银行，咨询，其他
学习考试：托福，雅思，CET4/6，GRE，GMAT，MBA，考研，高考，中考，职业认证，公务员，其他
粉丝
置业安家：业主，装修
品牌产品
同事<em>同学</em>朋友：亲友，同学，同事</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 群组类型</span>
        <span class="nx">description</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s2">&quot;A Group of iCollege&quot;</span><span class="p">},</span> <span class="c1">// 群组介绍</span>
        <span class="nx">location</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="s1">&#39;2dsphere&#39;</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mf">0.0</span><span class="p">}],</span><span class="c1">// longitude latitude</span>
        <span class="nx">location_info</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span><span class="c1">// location name</span>
        <span class="nx">permission_on_add</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;not_allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;need_permission&#39;</span><span class="p">,</span> <span class="s1">&#39;need_nothing&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;need_permission&#39;</span><span class="p">},</span> <span class="c1">// 添加成员进群组时的审核策略：不需要审核或需要管理员审核等</span>
        <span class="nx">visibility</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 对附近人的可见性</span>
        <span class="nx">credit</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span> <span class="c1">// 积分</span>
        <span class="nx">attachments</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
            <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;group_file&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">extension</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 文件扩展类型</span>
            <span class="nx">size</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="nx">path</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// 文件路径</span>
            <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
        <span class="p">}],</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>---------------------------------------- 扩充以下的实体字段 注:根据mongoose标准添加，如果有default，就无需加上required ------------- //</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="circles%20%E5%9C%88%E5%AD%90%E5%AE%9E%E4%BD%93">
  <h3>
    <a href="#circles%20%E5%9C%88%E5%AD%90%E5%AE%9E%E4%BD%93" name="circles%20%E5%9C%88%E5%AD%90%E5%AE%9E%E4%BD%93" class="pilcrow">&#182;</a>
    circles 圈子实体
  </h3>
</div>


<p>系统会为每一个用户创建一个好友圈，这个圈子只会用来抓取别的好友的posts，不应该写入任何内容</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">circles</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">nickname</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// circle用于显示的名字，可以与其他圈子重复</span>
        <span class="nx">lowercase_circle_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">lowercase</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 小写形式，方便进行防止圈子命名重复测试</span>
        <span class="nx">circle_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 标记了圈子的唯一性</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>圈主，圈子拥有者</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// user object id</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>

<div class="highlight"><pre><code>   <span class="err">圈子管理员，非！系统管理员</span>
   <span class="nx">related_ids</span><span class="o">:</span> <span class="p">[{</span>
       <span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span>
       <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
   <span class="p">}],</span>
</code></pre></div>



<p>user list, 全部的用户列表，包含圈主和管理员</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">members</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">member_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">member_name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">related</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 是否为圈子管理员，圈子主也标记related为true</span>
            <span class="nx">status</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;refused&#39;</span><span class="p">,</span> <span class="s1">&#39;agreed&#39;</span><span class="p">,</span> <span class="s1">&#39;expired&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;pending&#39;</span><span class="p">}</span> <span class="c1">// 已经成为成员了吗，成员记录会在用户加入群组申请提交后插入，但是状态为pending，但是一旦被refuse，该记录择日会被清除，但是由成员申请构建生成的系统消息不会消失</span>
        <span class="p">}],</span>
        <span class="nx">avatar</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>we have a limited range of categories for user to select, but not listed here as enums
兴趣爱好：影视，音乐，星座，动漫，运动，读书，摄影，其他
生活休闲：同城，同乡，购物，旅游，美食，美容，宠物，健康，母婴，其他
游戏
行业交流：投资，IT/互联网，建筑工程，服务，传媒，营销与广告，教师，律师，公务员，银行，咨询，其他
学习考试：托福，雅思，CET4/6，GRE，GMAT，MBA，考研，高考，中考，职业认证，公务员，其他
粉丝
置业安家：业主，装修
品牌产品
同事<em>同学</em>朋友：亲友，同学，同事</p>

<p><strong>圈子应该额外加一个category，是系统生成的专属个人朋友圈，还是用户创建的</strong></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 圈子类型，参考微群组</span>
        <span class="nx">description</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// 圈子介绍</span>
        <span class="nx">location</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="s1">&#39;2dsphere&#39;</span><span class="p">}],</span> <span class="c1">// longitude latitude</span>
        <span class="nx">location_info</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// location name</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>添加成员进圈子时的审核策略：不需要审核或需要管理员审核等</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">permission_on_add</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;not_allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;need_permission&#39;</span><span class="p">,</span> <span class="s1">&#39;need_nothing&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;need_permission&#39;</span><span class="p">},</span>
        <span class="nx">visibility</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 对附近人的可见性</span>
        <span class="nx">credit</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span> <span class="c1">// 积分</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E6%B6%88%E6%81%AF%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E6%B6%88%E6%81%AF%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%B6%88%E6%81%AF%E5%92%8C%E8%81%8A%E5%A4%A9%E6%B6%88%E6%81%AF">
  <h3>
    <a href="#%E6%B6%88%E6%81%AF%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E6%B6%88%E6%81%AF%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%B6%88%E6%81%AF%E5%92%8C%E8%81%8A%E5%A4%A9%E6%B6%88%E6%81%AF" name="%E6%B6%88%E6%81%AF%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E6%B6%88%E6%81%AF%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%B6%88%E6%81%AF%E5%92%8C%E8%81%8A%E5%A4%A9%E6%B6%88%E6%81%AF" class="pilcrow">&#182;</a>
    消息实体 一定要考虑消息的共通性，系统消息和聊天消息
  </h3>
</div>


<p>消息没有常规的 user_id 和 related_ids 字段，因为消息无所有者，仅有管理员和超级管理员可以删除</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">messages</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
        <span class="nx">content</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">source_category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">],</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 消息来自于个人（好友或系统（系统也是一个人类账号）），还是群组</span>
        <span class="nx">group_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">},</span> <span class="c1">// 仅有在消息来源于groups时此字段才有值</span>
        <span class="nx">content_category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;media&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;system&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span><span class="p">},</span> <span class="c1">// 消息类型：多媒体消息（视频，纯图片，音频），富文本消息(html，谨防js注入)，其他类型的系统消息（好友请求，其他由系统relay的具有特殊格式的消息），</span>
        <span class="nx">message_from</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 从这也能看出来，账户必须有角色，角色具有权限分级，并预留一个账户具备超级管理员角色，可以赋予普通用户管理员角色</span>
        <span class="nx">message_to</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">},</span>
            <span class="nx">being_pulled</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">}</span> <span class="c1">// 前端是否曾经抓取过</span>
        <span class="p">}],</span> <span class="c1">// to的多样性，用户，群组</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span> <span class="c1">// 消息的某些状态被改变，改变者为谁</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E5%B8%96%E5%AD%90%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E5%B8%96%E5%AD%90%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E5%8F%91%E5%B8%96%EF%BC%88%E6%97%A5%E5%BF%97%EF%BC%89%EF%BC%9B%E5%AD%98%E5%9C%A8%E4%BA%8E%E5%9C%88%E5%AD%90%E9%87%8C%EF%BC%88%E6%89%80%E4%BB%A5%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9C%88%E5%AD%90%EF%BC%8C%E5%A5%BD%E5%8F%8B%E5%9C%88%EF%BC%8C%E5%85%B6%E4%BB%96%E5%9C%88%E5%AD%90%E9%83%BD%E6%98%AF%E9%A2%9D%E5%A4%96%E5%88%9B%E5%BB%BA%E7%9A%84%EF%BC%89">
  <h3>
    <a href="#%E5%B8%96%E5%AD%90%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E5%B8%96%E5%AD%90%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E5%8F%91%E5%B8%96%EF%BC%88%E6%97%A5%E5%BF%97%EF%BC%89%EF%BC%9B%E5%AD%98%E5%9C%A8%E4%BA%8E%E5%9C%88%E5%AD%90%E9%87%8C%EF%BC%88%E6%89%80%E4%BB%A5%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9C%88%E5%AD%90%EF%BC%8C%E5%A5%BD%E5%8F%8B%E5%9C%88%EF%BC%8C%E5%85%B6%E4%BB%96%E5%9C%88%E5%AD%90%E9%83%BD%E6%98%AF%E9%A2%9D%E5%A4%96%E5%88%9B%E5%BB%BA%E7%9A%84%EF%BC%89" name="%E5%B8%96%E5%AD%90%E5%AE%9E%E4%BD%93%20%E4%B8%80%E5%AE%9A%E8%A6%81%E8%80%83%E8%99%91%E5%B8%96%E5%AD%90%E7%9A%84%E5%85%B1%E9%80%9A%E6%80%A7%EF%BC%8C%E5%8F%91%E5%B8%96%EF%BC%88%E6%97%A5%E5%BF%97%EF%BC%89%EF%BC%9B%E5%AD%98%E5%9C%A8%E4%BA%8E%E5%9C%88%E5%AD%90%E9%87%8C%EF%BC%88%E6%89%80%E4%BB%A5%E4%BA%BA%EF%BC%8C%E9%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9C%88%E5%AD%90%EF%BC%8C%E5%A5%BD%E5%8F%8B%E5%9C%88%EF%BC%8C%E5%85%B6%E4%BB%96%E5%9C%88%E5%AD%90%E9%83%BD%E6%98%AF%E9%A2%9D%E5%A4%96%E5%88%9B%E5%BB%BA%E7%9A%84%EF%BC%89" class="pilcrow">&#182;</a>
    帖子实体 一定要考虑帖子的共通性，发帖（日志）；存在于圈子里（所以人，都有一个自己的圈子，好友圈，其他圈子都是额外创建的）
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">posts</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">slug</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 帖子的标识符，时间与title与作者关联组成，标注了帖子的唯一性</span>
        <span class="nx">title</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span>
        <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 用户Id，谁发的帖子</span>
        <span class="nx">circle_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">},</span> <span class="c1">// 圈子Id，自己专属朋友圈的ID或自己加入的朋友圈的ID</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>帖子的来源，好友圈（默认），或是其他某一个圈子：好友圈这个圈子专属于自己，这个圈子包含了用户的所有好友</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">source_category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">,</span> <span class="s1">&#39;circles&#39;</span><span class="p">],</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>================== 转发信息 ==================</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">is_forward</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="c1">// 是否为转发</span>
        <span class="nx">forward_info</span><span class="o">:</span> <span class="p">{</span>     <span class="c1">// 转发信息</span>
            <span class="nx">forward_message</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span>
            <span class="nx">post_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">}</span>
        <span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>================== 原创信息 ==================</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">html</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// 帖子内容，谨防js注入</span>
        <span class="nx">attachments</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
            <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">extension</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 文件扩展类型</span>
            <span class="nx">size</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="nx">path</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// 文件路径</span>
            <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
        <span class="p">}],</span>
        <span class="nx">status</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;draft&#39;</span><span class="p">},</span> <span class="c1">// 帖子的状态，draft or published</span>
        <span class="nx">language</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">,</span> <span class="s1">&#39;en_US&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;zh_CN&#39;</span><span class="p">},</span> <span class="c1">// 帖子的语言</span>

        <span class="nx">at_users</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">}],</span> <span class="c1">// @user ids</span>
        <span class="nx">favored_users</span><span class="o">:</span> <span class="p">[{</span> <span class="c1">// 点赞的用户</span>
            <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 用户ID</span>
            <span class="nx">timestamp</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">}</span>   <span class="c1">// 点赞的时间</span>
        <span class="p">}],</span>
        <span class="nx">viewed_times</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span> <span class="c1">// 浏览过的次数，不限制同一个用户浏览多次</span>
        <span class="nx">published_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">published_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E5%9B%9E%E5%B8%96%E5%AE%9E%E4%BD%93">
  <h3>
    <a href="#%E5%9B%9E%E5%B8%96%E5%AE%9E%E4%BD%93" name="%E5%9B%9E%E5%B8%96%E5%AE%9E%E4%BD%93" class="pilcrow">&#182;</a>
    回帖实体
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">reposts</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 用户Id，谁发的帖子回复</span>
        <span class="nx">circle_id</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">},</span> <span class="c1">// 圈子Id，回帖回的帖子属于哪个圈子 !!是否应该存在默认值（好友圈），是否必须？</span>
        <span class="nx">source_category</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;posts, reposts&#39;</span><span class="p">]},</span> <span class="c1">// 是来自于帖子 还是 回帖</span>
        <span class="nx">repost_to</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 帖子ID或是回帖ID</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>================== 回帖内容 ==============</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">html</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// 帖子内容，谨防js注入</span>
        <span class="nx">attachments</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// uuid</span>
            <span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
            <span class="nx">extension</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="c1">// 文件扩展类型</span>
            <span class="nx">size</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="nx">path</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span> <span class="c1">// 文件路径</span>
            <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
            <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
        <span class="p">}],</span>
        <span class="nx">language</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">,</span> <span class="s1">&#39;en_US&#39;</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;zh_CN&#39;</span><span class="p">},</span>

        <span class="nx">at_users</span><span class="o">:</span> <span class="p">[{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">}],</span> <span class="c1">// @user ids</span>

        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="%E8%AE%BE%E7%BD%AE%E5%AE%9E%E4%BD%93%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%EF%BC%8C%E4%B9%9F%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B8%80%E4%BA%9B%E7%B3%BB%E7%BB%9F%E7%BA%A7%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">
  <h3>
    <a href="#%E8%AE%BE%E7%BD%AE%E5%AE%9E%E4%BD%93%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%EF%BC%8C%E4%B9%9F%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B8%80%E4%BA%9B%E7%B3%BB%E7%BB%9F%E7%BA%A7%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE" name="%E8%AE%BE%E7%BD%AE%E5%AE%9E%E4%BD%93%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%EF%BC%8C%E4%B9%9F%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B8%80%E4%BA%9B%E7%B3%BB%E7%BB%9F%E7%BA%A7%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE" class="pilcrow">&#182;</a>
    设置实体，相当于数据字典，也相当于一些系统级的默认配置
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">uuid</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">key</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
        <span class="nx">value</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>TODO: add more setting types for icollege</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">type</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;core&#39;</span><span class="p">,</span> <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;circle&#39;</span><span class="p">]},</span>
        <span class="nx">created_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">created_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">},</span>
        <span class="nx">updated_at</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()},</span>
        <span class="nx">updated_by</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Schema</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">}</span>
    <span class="p">}</span>

<span class="p">};</span>

<span class="kd">function</span> <span class="nx">isPost</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">jsonData</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;slug&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">isRePost</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">collections</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">checks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">isPost</span><span class="o">:</span> <span class="nx">isPost</span><span class="p">,</span>
    <span class="nx">isRePost</span><span class="o">:</span> <span class="nx">isRePost</span>
<span class="p">};</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
